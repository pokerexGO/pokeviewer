<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PokeViewer</title>
  <style>
    :root {
      --bg: #0d1117;
      --card-red: #d62828;
      --screen: #222;
      --accent: #ffcc00;
      --muted: #9aa4b2;
      --text: #e6edf3;
      --glass: rgba(255,255,255,0.02);
      --border: #444;
    }
    html,body {
      height:100%;
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--text);
      font-family:Arial,Helvetica,sans-serif;
      overflow:hidden;
    }
    body {
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      box-sizing:border-box;
    }
    .wrapper{width:100%;max-width:380px;}
    .title-row{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:12px;}
    .bolt{width:32px;height:32px;background:linear-gradient(180deg,#fff8b0,#ffcc00);
      clip-path:polygon(35% 0%,60% 0%,40% 55%,70% 55%,30% 100%,40% 60%,10% 60%);
      filter:drop-shadow(0 2px 6px rgba(0,0,0,0.5));opacity:0.9;}
    .title{font-size:1.7rem;font-weight:800;color:var(--accent);text-shadow:0 0 10px #ffcc0088;letter-spacing:0.6px;}
    .pokedex{background:var(--card-red);border-radius:18px;padding:18px;
      box-shadow:0 10px 40px rgba(0,0,0,0.6);border:2px solid rgba(0,0,0,0.35);
      display:flex;flex-direction:column;align-items:center;}
    .screen-container{background:var(--screen);border-radius:10px;border:3px solid var(--border);
      padding:14px;min-height:280px;max-height:50vh;width:100%;overflow:auto;box-sizing:border-box;}
    .pokemon-img{width:160px;height:160px;display:block;margin:10px auto;border-radius:8px;
      background:var(--screen);animation:float 2.2s ease-in-out infinite;}
    @keyframes float{0%{transform:translateY(0);}50%{transform:translateY(-8px);}100%{transform:translateY(0);}}
    #resultado p{background:rgba(0,0,0,0.35);padding:10px;border-radius:8px;margin:8px 0;line-height:1.45;}
    .tag{background:var(--accent);padding:4px 10px;border-radius:6px;font-weight:700;color:#0d1117;margin-right:8px;display:inline-block;}
    .controls{margin-top:10px;display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;}
    input[type="text"]{padding:12px 14px;border-radius:10px;width:64%;border:none;text-align:center;outline:none;font-size:1.1rem;}
    .btnBuscar{padding:12px 14px;border-radius:10px;background:var(--accent);color:#0d1117;border:none;font-weight:800;cursor:pointer;font-size:1.05rem;}
    .btnClear{padding:12px 14px;border-radius:10px;background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.06);cursor:pointer;font-size:1.05rem;}
    #btnAudio{margin:6px 0;width:100%;padding:14px;border-radius:10px;background:#222;border:2px solid transparent;color:#fff;cursor:pointer;font-weight:700;font-size:1.05rem;display:none;}
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="title-row">
      <div class="bolt"></div>
      <div class="title">PokeViewer</div>
      <div class="bolt"></div>
    </div>
    <div class="pokedex">
      <div class="screen-container" id="screenContainer">
        <div id="screen"><p>üîç Escribe un nombre de Pok√©mon para comenzar.</p></div>
      </div>
      <button id="btnAudio">üîä Leer</button>
      <div class="controls">
        <input id="pokemonInput" type="text" placeholder="Ej: Pikachu"/>
        <button id="buscarBtn" class="btnBuscar">Buscar</button>
        <button id="clearBtn" class="btnClear">Limpiar</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const input=document.getElementById('pokemonInput');
    const buscarBtn=document.getElementById('buscarBtn');
    const clearBtn=document.getElementById('clearBtn');
    const screen=document.getElementById('screen');
    const btnAudioEl=document.getElementById('btnAudio');
    let paragraphs=[];

    function esc(s){return s?String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"";}

    async function buscarPokemon(nombre){
      if(!nombre)return;
      screen.innerHTML=`<p>üîé Buscando informaci√≥n sobre <strong>${esc(nombre)}</strong>...</p>`;
      btnAudioEl.style.display="none";
      try{
        const r=await fetch("/api/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pokemon:nombre})});
        const d=await r.json();
        if(!d.respuesta){screen.innerHTML="<p>‚ùå Error al obtener datos.</p>";return;}
        const texto=d.respuesta;
        paragraphs=[texto];
        screen.innerHTML=`<h2>${nombre.toUpperCase()}</h2><p>${esc(texto)}</p>`;
        btnAudioEl.style.display="block";
      }catch(e){
        console.error(e);
        screen.innerHTML="<p>‚ùå Error al conectar con el servidor.</p>";
      }
    }

    buscarBtn.addEventListener("click",()=>{const n=input.value.trim().toLowerCase();if(n)buscarPokemon(n);});
    clearBtn.addEventListener("click",()=>{input.value="";screen.innerHTML="<p>üîç Escribe un nombre de Pok√©mon para comenzar.</p>";btnAudioEl.style.display="none";});

    btnAudioEl.addEventListener("click",async()=>{
      if(!paragraphs.length)return;
      btnAudioEl.textContent="üîä Generando voz...";
      try{
        const resp=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:paragraphs.join(". ")})});
        if(!resp.ok)throw new Error("Error TTS");
        const blob=await resp.blob();
        const url=URL.createObjectURL(blob);
        const audio=new Audio(url);
        await audio.play();
        btnAudioEl.textContent="üîä Leer";
      }catch(e){
        console.error(e);
        alert("Audio no disponible en AppCreator24.");
        btnAudioEl.textContent="üîä Leer";
      }
    });
  })();
  </script>
</body>
</html>
